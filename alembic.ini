# Alembic Configuration for WhatsNext
#
# Database migrations are managed using Alembic.
# The actual database URL is loaded from environment/.env file.
#
# Usage:
#   alembic upgrade head     # Apply all migrations
#   alembic downgrade -1     # Rollback one migration
#   alembic revision --autogenerate -m "description"  # Create new migration
#
# Or use the CLI:
#   whatsnext db upgrade     # Apply all migrations
#   whatsnext db downgrade   # Rollback one migration
#   whatsnext db status      # Show current revision

[alembic]
# Path to migration scripts (relative to this file)
script_location = whatsnext/api/server/migrations

# Template used for new migration files
file_template = %%(year)d%%(month).2d%%(day).2d_%%(hour).2d%%(minute).2d_%%(rev)s_%%(slug)s

# Truncate long revision identifiers for readability
truncate_slug_length = 40

# Set to 'true' to run the environment during 'revision --autogenerate'
revision_environment = false

# Timezone for migration file names (use 'utc' for consistency)
timezone = utc

# Set to true to require a version path be specified on first run
version_path_separator = os

# Output encoding for migration files
output_encoding = utf-8

# Don't include the sqlalchemy.url here - it's loaded from environment in env.py


[post_write_hooks]
# Run ruff format on new migration files
hooks = ruff_format
ruff_format.type = exec
ruff_format.executable = ruff
ruff_format.options = format REVISION_SCRIPT_FILENAME


[loggers]
keys = root,sqlalchemy,alembic

[handlers]
keys = console

[formatters]
keys = generic

[logger_root]
level = WARN
handlers = console
qualname =

[logger_sqlalchemy]
level = WARN
handlers =
qualname = sqlalchemy.engine

[logger_alembic]
level = INFO
handlers =
qualname = alembic

[handler_console]
class = StreamHandler
args = (sys.stderr,)
level = NOTSET
formatter = generic

[formatter_generic]
format = %(levelname)-5.5s [%(name)s] %(message)s
datefmt = %H:%M:%S
